<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DBT Coping Skills Chatbot</title>
  <link rel="icon" type="image/png" href="https://emojiapi.dev/api/v1/speech_balloon/64.png" />
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; max-width: 600px; margin: auto; background: #e8f0ff; }
    h1 { text-align: center; color: #2c3e50; }
    #chat { margin-top: 2rem; background: #fff; padding: 1rem; border-radius: 8px; height: 400px; overflow-y: auto; border: 1px solid #ccc; }
    .message { margin: 0.5rem 0; }
    .user { text-align: right; color: #2c3e50; }
    .bot { text-align: left; color: #2e7d32; }
    input, select, button { width: 100%; padding: 0.5rem; margin-top: 0.5rem; border-radius: 5px; border: 1px solid #ccc; }
    #log { margin-top: 1rem; font-size: 0.9rem; background: #eef; padding: 0.5rem; border-radius: 4px; white-space: pre-wrap; }
    footer { margin-top: 2rem; font-size: 0.8rem; text-align: center; color: #777; }
    #downloadBtn { margin-top: 1rem; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    #downloadBtn:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>ðŸ’¬ DBT Coping Skills Chatbot</h1>
  <div id="chat"></div>
  <form id="chatForm">
    <input type="text" id="userInput" placeholder="How are you feeling or what do you need help with?" required />
    <select id="goal">
      <option value="">Choose a DBT skill category (optional)</option>
      <option value="emotion regulation">Emotion Regulation</option>
      <option value="distress tolerance">Distress Tolerance</option>
      <option value="mindfulness">Mindfulness</option>
      <option value="interpersonal effectiveness">Interpersonal Effectiveness</option>
    </select>
    <button type="submit">Send</button>
  </form>
  <div id="log"></div>
  <button id="downloadBtn">ðŸ“¥ Download Conversation Log</button>
  <footer>
    <p><strong>Disclaimer:</strong> This chatbot is not a replacement for professional care. If in crisis, call or text <strong>988</strong>.</p>
  </footer>
  <script>
    const skills = {
      "emotion regulation": [
        "Try 'Opposite Action': When your emotions urge a specific behavior (like hiding when sad), do the opposite to shift your mood.",
        "Use 'PLEASE': Take care of your body with balanced meals, avoid substances, exercise, sleep wellâ€”physical wellness impacts emotions.",
        "Make a joy list: List small actions that bring joyâ€”like petting a dog, dancing, or drawingâ€”and do one now."
      ],
      "distress tolerance": [
        "Use 'TIPP': Regulate body chemistry quickly using cold water (Temperature), intense movement, paced breathing, and muscle relaxation.",
        "Distract using 'ACCEPTS': Engage in Activities, help others (Contributing), compare past successes, shift Emotions, Push away stress, focus Thoughts, or use Sensory tools.",
        "Grab something grounding (like an ice cube or textured object) and focus only on it for 1 minute to calm distress."
      ],
      "mindfulness": [
        "'Observe, Describe, Participate': Notice your experiences without judgment, put them into words, and engage fully in the moment.",
        "Use 'Wise Mind': Combine your Emotional Mind and Rational Mind for balanced, intuitive decision-making.",
        "Breathing meditation: Inhale slowly (count to 4), exhale (count to 4), and repeat while gently labeling the breath."
      ],
      "interpersonal effectiveness": [
        "Use 'DEAR MAN': Express needs clearlyâ€”Describe the situation, Express feelings, Assert needs, Reinforce outcomes, stay Mindful, Appear confident, and Negotiate.",
        "'GIVE' for relationships: Be Gentle, show Interest, Validate the other, and keep an Easy manner.",
        "'FAST' for self-respect: Be Fair, donâ€™t over-Apologize, Stick to your values, and be Truthful."
      ]
    };

    const chat = document.getElementById('chat');
    const form = document.getElementById('chatForm');
    const log = document.getElementById('log');
    const downloadBtn = document.getElementById('downloadBtn');
    let conversationLog = [];

    function addMessage(text, className) {
      const div = document.createElement('div');
      div.className = `message ${className}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function logEntry(user, bot) {
      const timestamp = new Date().toLocaleTimeString();
      conversationLog.push(`[${timestamp}] You: ${user}
[${timestamp}] Bot: ${bot}`);
      log.textContent = conversationLog.join('

');
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const input = document.getElementById('userInput');
      const goal = document.getElementById('goal').value;
      const userText = input.value.trim();
      if (!userText) return;

      addMessage(userText, 'user');
      input.value = '';

      let response = "Thanks for sharing. Here's something that might help: ";
      let suggestion;
      if (skills[goal]) {
        const options = skills[goal];
        suggestion = options[Math.floor(Math.random() * options.length)];
      } else {
        const all = Object.values(skills).flat();
        suggestion = all[Math.floor(Math.random() * all.length)];
      }
      response += `

${suggestion}`;

      setTimeout(() => {
        addMessage(response, 'bot');
        logEntry(userText, suggestion);
      }, 500);
    });

    downloadBtn.addEventListener('click', function () {
      const blob = new Blob([conversationLog.join('

')], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dbt_chat_log.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
